---
title: ""
format: html
editor: visual
quarto:
  warnings: false
---

# Prosjektoppgave 1005

```{r echo = FALSE, message=FALSE}
#laster inn nødvenidige pakker

rm(list=ls())
  library(ggmap)
  library(kableExtra)
  library(plotly)
  library(tidyverse)
  library(readr)
  library(lubridate)

```

```{r echo = FALSE, message=FALSE}
#henter data fra github
df <- read_csv("https://raw.githubusercontent.com/eskilaglen/data/main/1005data/df%20(2).csv")

#gjør så dataen starter på uke 1
df <- df %>% 
  mutate(WEEK = WEEK - 15)
```

## Oppgave 2 - ukentlig salgsrapport

I en ukentlig salgsrapport får vi en detaljert analyse av salgsdataene gjennom en kortere periode. Vi har valgt å fokusere på butikk 64, som har solgt mest i 1990 (uke 6, 7, 8 og 9). I tillegg til å se nærmere på et butikknivå, har vi også valgt å analysere hvert enkelt varemerke i den ukentlige salgsrapporten. Dette gir oss innsikt i markedsandeler, og hvilke varemerker som bidrar mest til salg, profitt og prising.  

Varetypen vi fikk utdelt var \"crackers\". 

### **Salgsfordelig** 

Figur 1 er et kakediagram som visualiserer markedsandelen til de fem største merkene innen \"crackers\" kategorien i den valgte perioden. Kakediagrammet gir en enkel og visuell representasjon av forholdet mellom de ulike merkene og deres andel av det totale markedet. Basert på figur 1 ser vi tydelig at NAB har en betydelig større markedsandel enn de fire andre konkurrentene i Chicago området. 

```{r echo = FALSE, message=FALSE}
#fjerner warning meldinger fra html
options(warn = -1) 

#velger ut butikk og ukene vi skal se på
df_ukentlig <-subset(df, STORE == "64" & WEEK %in% c("6","7", "8", "9"))

#summerer alle merker alle uker
total_sales_by_brand <- aggregate(df_ukentlig$Movement_sum, by=list(df_ukentlig$BRAND), sum)

#kalkulerer markedsandel prosentvis
total_sales_by_brand$Market_Share <- total_sales_by_brand$x / sum(total_sales_by_brand$x) * 100

#plotter og styler figur 1
plot_ly(total_sales_by_brand, labels = ~Group.1, values = ~x, type = 'pie',
        marker = list(colors = c('#98FB98', '#FF6F61', '#AEC6CF')),
        customdata = ~paste('Total sale: ', round(x), '<br>Total sale in %: ', round(Market_Share), '%'),
        hovertemplate = '<b>%{label}</b><br>%{customdata}<extra></extra>') %>%
  layout(title = list(text = 'Figur 1: Markedsandel etter merke', y = 0.9),  
         showlegend = TRUE,
         legend = list(title = 'Brand'),
         margin = list(t = 100), 
         height = 400,
         width = 500)
```

### **Salgsutvikling** 

Figur 2 er et søylediagram som viser salgsinntektene for de fem valgte merkene innenfor "crackers"-markedet i Chicago over de fire valgte ukene. Denne typen søylediagram viser ukentlige forskjeller tydelig, og sammenligner merkene side ved side. Diagrammet viser at merkene opplevde gjennomgående gode salg i uke 6, hvor Nab, Keebler og Sunshine hadde sine høyeste salgstall gjennom perioden. For Old og Salerno var uke 6 deres nest beste uke.  

```{r echo = FALSE, message=FALSE}
#fjerner warning meldinger fra html
options(warn = -1) 

#summerer opp ukentlig data etter merke og uke
df_ukentlig <- df_ukentlig %>%
  group_by(WEEK, BRAND) %>%
  summarise(Sale_sum = sum(Sale_sum), Movement_sum = sum(Movement_sum), Price_average = sum(Price_average), Profit_sum = sum(Profit_sum), .groups = "drop")

#plotter og styler figur 2
figur2 <- ggplot(data = df_ukentlig, aes(x = WEEK, y = Sale_sum, fill = BRAND)) +
  geom_bar(stat = "identity", width = 0.5) +
  facet_wrap(~ BRAND, nrow = 1) +
  labs(x = "Uke", y = "Salg") +
  scale_fill_brewer(palette = "Set2") +
  theme_minimal()

figur2 <- ggplotly(figur2) %>%
  layout(
    title = "Figur 2: Salgsanalyse ukentlig etter merke",
    legend = list(title = "Brand"),
    margin = list(l = 40, r = 40, t = 60, b = 40),
    plot_bgcolor = "rgb(240, 240, 240)",
    paper_bgcolor = "rgb(240, 240, 240)",
    hovertemplate = "<b>Week</b>: %{x}<br><b>Sales</b>: %{y}<extra></extra>"
  )

figur2
```

### **Proffitmargin** 

For å evaluere lønnsomheten til hvert enkelt merke, ser vi på profittmarginene. Profittmarginen viser hvor stor andel av hver dollar i salg som blir til profitt, så en høyere profittmargin gir bedre fortjeneste per vare. 

Figur 3 illustrerer at Sunshine er det merket som mest effektivt konverterer salg til profitt, med over 40 prosent av salgspris som ren profitt. Salerno har den laveste profittmarginen per salg. Det er også verdt å merke seg at Salerno er et merke med lavt salgsvolum i det valgte utsalget. Salerno er dermed trolig ikke et merke det er verdt å satse på videre, da det verken genererer mye profitt eller har høye salgstall.   

```{r echo = FALSE, message=FALSE}
#fjerner warning meldinger fra html
options(warn = -1) 

#summerer opp all data etter merke
df_ukentlig_total <- df_ukentlig %>%
  group_by(BRAND) %>%
  summarise(Sale_sum = sum(Sale_sum), Movement_sum = sum(Movement_sum), Price_average = mean(Price_average), Profit_sum = sum(Profit_sum), .groups = "drop")

#plotter og styler figur 3
figur3 <- df_ukentlig_total %>%
  mutate(profittmargin = (Profit_sum/Sale_sum)*100) %>%
  ggplot(aes(x = BRAND, y = profittmargin, fill = BRAND)) +
  geom_col() +
  labs(x = "", y = "Profittmargin %") +
  theme_minimal()

figur3 <- ggplotly(figur3)

figur3 <- figur3 %>% layout(
  title = "Figur 3: Profitmargin etter merke",
  legend = list(title = "Category"),
  margin = list(l = 40, r = 40, t = 60, b = 40),
  plot_bgcolor = "rgb(240, 240, 240)",
  paper_bgcolor = "rgb(240, 240, 240)"
)

figur3

```

### **Profitt og gjennomsnittlig pris** 

Figur 4 er et \"stacked bar plot\" som sammenligner den totale profitten generert i perioden med gjennomsnittlig pris pr vare. Fordelen med et slikt plot er at det gjør forskjeller lett å observere, og det gjør sammenligninger med flere variabler lett fordøyelig. Vi kan her se NAB har ekstremt høye tall for profitt i forhold til prisen, i motsetning til Keebler, som har de dyreste crackersene, men ikke store profitter.  

```{r echo = FALSE, message=FALSE}
#fjerner warning meldinger fra html
options(warn = -1) 

#plotter og styler figur 4
figur4 <- ggplot(data = df_ukentlig_total) +
  geom_bar(aes(x = BRAND, y = Profit_sum/10, fill = "Sum Profit"), stat = "identity", width = 0.5) +
  geom_bar(aes(x = BRAND, y = Price_average, fill = "Avg Price"), stat = "identity", width = 0.5) +
  labs(x = "", y = "") +
  scale_fill_manual(values = c("Sum Profit" = "#008080", "Avg Price" = "#ff7f0e")) +
  theme_minimal()

figur4 <- ggplotly(figur4)

figur4 <- figur4 %>% layout(
  title = "Figur 4: Profitt og gjennomsnittlig pris analyse etter merke",
  legend = list(title = "Category"),
  margin = list(l = 40, r = 40, t = 60, b = 40),
  plot_bgcolor = "rgb(240, 240, 240)",
  paper_bgcolor = "rgb(240, 240, 240)"
)

figur4
```

*I figur 4 er summen av profitt delt på 10, slik at den gjennomsnittlige prisen skal være synlig og tolkbar.*

## Oppgave 3 - Månedlig salgsrapport

En månedlig salgsrapport gir en omfattende oversikt over salgsdataene over en lengre periode. Vi fokuserer på hele året 1990 og analyserer salget til butikk 80 og butikk 75. Store 75 -- sentralt i Chicago er den butikken med lavest medianinntekt pr kunde, mens Store 80 -- i Arlington Heights, er i toppen av inntekskalaen  

Ved å se på salgstallene og trender i løpet av året 1990 for disse butikkene, får vi innsikt i deres utvikling i denne perioden. Vi ser også nærmere på hvert enkelt varemerke for å finne ut hvilke merker som bidrar mest til salgsøkningen i hver av butikkene. Vi ser også på kupongbruk og nærmere på demografien av kundene som handler der. 

```{r echo = FALSE, message=FALSE}
#fjerner warning meldinger fra html
options(warn = -1) 

#fjerner uker med mindre enn 50 uker med data for et bedre total bilde
df <- df %>%
  group_by(STORE) %>%
  filter(n_distinct(WEEK) >= 50) %>%
  ungroup()

#velger 2 butikker 
df_månedlig <- subset(df, STORE == "75" | STORE == "80")

#summerer opp data etter måned og butikk
df_månedlig1 <- df_månedlig %>%
  mutate(WEEK = as.numeric(WEEK)) %>%
  mutate(MONTH = ceiling(WEEK / 4)) %>%
  group_by(MONTH, STORE) %>%
  summarise(Sale_sum = sum(Sale_sum ), Movement_sum = sum(Movement_sum),Price_average = mean(Price_average), Profit_sum = sum(Profit_sum), .groups = "drop")
```

### **Totalt salg per butikk - månedlig** 

Figur 5 viser det totale salget for hver butikk i løpet av året. Ved å se på det totale salget i hver butikk månedlig, får vi innsikt i hvordan hver av butikkene har presterert over tid. Vi ser her at butikk 80 har store forskjeller gjennom året, med store hopp enkelte måneder.  Samtidig holder store 75 seg på et lavere nivå med færre merkbare endringer løpet av året.   

```{r echo = FALSE, message=FALSE}
#fjerner warning meldinger fra html
options(warn = -1) 

#fjerner måned 14
df_månedlig1 <- df_månedlig1[df_månedlig1$MONTH != 14, ]

#plotter og styler figur 5
figur5 <- ggplot(data = df_månedlig1, aes(x = MONTH, y = Sale_sum)) +
  geom_line(group=1, size=1, color = "orange") +
  facet_wrap(~ STORE, nrow = 1) +
  labs(x = "Måned", y = "Salg") +
  scale_fill_brewer(palette = "Set2") +
  theme_minimal()

figur5 <- ggplotly(figur5)

figur5 <- figur5 %>% layout(
  title = "Figur 5: Salgsanalyse etter butikk",
  legend = list(title = "Store"),
  margin = list(l = 40, r = 40, t = 60, b = 40),
  plot_bgcolor = "rgb(240, 240, 240)",
  paper_bgcolor = "rgb(240, 240, 240)"
)

figur5
```

### **Prosentandel bidrag til total profitt fra hvert merke - månedlig** 

Figur 6 viser det totale salget for begge butikker i prosentandel (1 søyle = 100 %) og den relative andelen som hver av merkene bidrar til salget på månedsbasis. Denne typen figur er nyttig i en salgsrapport da den på en effektiv og enkel måte viser hvor stor andel av det totale salget hvert merke representerer til enhver tid. NAB har generelt sett den største markedsandelen blant de fem merkene i våre utsalg med unntak av måned 3, hvor Sunshine hadde en sterk periode. 

```{r echo = FALSE, message=FALSE}
#fjerner warning meldinger fra html
options(warn = -1) 

#summerer opp data etter månede og merke
df_månedlig_percent <- df %>%
  mutate(WEEK = as.numeric(WEEK)) %>%
  mutate(MONTH = ceiling(WEEK / 4)) %>%
  group_by(MONTH, BRAND) %>%
  summarise(Sale_sum = sum(Sale_sum), Movement_sum = sum(Movement_sum), Price_average = sum(Price_average), Profit_sum = sum(Profit_sum), .groups = "drop")


#summerer opp data etter månede, og lager en percent kolonne
df_månedlig_percent <- df_månedlig_percent %>%
  group_by(MONTH) %>%
  mutate(PERCENTAGE = Profit_sum / sum(Profit_sum) * 100) %>%
  ungroup()



#plotter og styler figur 6
figur6 <- ggplot(data = df_månedlig_percent, aes(x = MONTH, y = PERCENTAGE, fill = BRAND)) +
  geom_bar(stat = "identity", width = 0.5) +
  labs(x = "Month", y = "Percentage of Profit") +
  scale_fill_brewer(palette = "Set2") +
  theme_minimal()


figur6 <- ggplotly(figur6)


figur6 <- figur6 %>% layout(
  title = "Figur 6: Prosentvis bidrag av salg etter merke",
  xaxis = list(title = "Måned"),
  yaxis = list(title = "Bidrag i prosent"),
  legend = list(title = "Brand"),
  margin = list(l = 40, r = 40, t = 60, b = 40),
  plot_bgcolor = "rgb(240, 240, 240)",
  paper_bgcolor = "rgb(240, 240, 240)",
  barmode = "stack"
)


figur6

```

```{r echo = FALSE, message=FALSE}
#fjerner warning meldinger fra html
options(warn = -1) 

#lager df med kun data med kupongkode 
df_månedlig_cupon <- df_månedlig [!is.na(df_månedlig $SALE), ]

#lager df uten data med kupongkode 
df_månedlig_no_cupon <- df_månedlig [!grepl("B", df_månedlig $SALE), ]

#summerer opp etter merke og butikk
df_månedlig_cupon <- df_månedlig_cupon %>%
  group_by(BRAND, STORE) %>%
  summarize(total_sales_cupon = sum(Sale_sum))

#summerer opp etter merke og butikk
df_månedlig_no_cupon <- df_månedlig_no_cupon %>%
  group_by(BRAND, STORE) %>%
  summarize(total_sales_no_cupon = sum(Sale_sum))

#summerer opp etter merke og butikk
df_månedlig_total <- df_månedlig %>%
  group_by(BRAND, STORE) %>%
  summarize(total_sales_total = sum(Sale_sum))

#setter sammen datasett
df_kupong <- merge(df_månedlig_total, df_månedlig_cupon, all = TRUE)

df_kupong <- merge(df_kupong, df_månedlig_no_cupon, all = TRUE)

```

### **Promoterte uker -- hva gjør promoteringer med salg?** 

Gjennom året har det vært flere uker med salg og promoteringer. Vi ser her nærmere på om salg i disse ukene bidrar til økt salg eller profitt. 

### **Totalt salg og kupongbruk etter merke**

Figur 7 viser totale salg per merke, og antall promosjonskuponger brukt.  Selv om skalaene er forskjellige, ser det ut til at mengden kuponger brukt i forhold til salg er tilnærmet like, med noe mer kupongbruk i butikk 80.  

```{r echo = FALSE, message=FALSE}
#fjerner warning meldinger fra html
options(warn = -1) 

#plotter og styler figur 7
figur7 <- ggplot(df_kupong, aes(x = BRAND, y = total_sales_total)) +
  geom_bar(stat = "identity", fill = "#1f77b4", color = "#1f77b4", width = 0.5) +
  geom_line(aes(y = total_sales_cupon, group = STORE), color = "orange") +
  geom_point(aes(y = total_sales_cupon, group = STORE), color = "orange", size = 3) +
  labs(title = "Total move with Coupon vs. Total Sales by Brand and Store",
       x = "", y = "Salg") +
  facet_wrap(~ STORE, labeller = label_both, scales = "free_y") +  
  theme_minimal()+
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

figur7 <- ggplotly(figur7)

figur7 <- figur7 %>% layout(
  title = "Figur 7: Salg og kupongbruk",
  legend = list(title = "Brand"),
  margin = list(l = 40, r = 40, t = 60, b = 40),
  plot_bgcolor = "rgb(240, 240, 240)",
  paper_bgcolor = "rgb(240, 240, 240)"
)

figur7
```

### **Totale salg og kupongbruk for alle merker**   

Figur 8 viser det totale salget av \"crackers\" månedlig på tvers av merker gjennom året, og linjen indikerer hvor mange promosjonskuponger som blir brukt i hver enkelt måned. Dette viser oss koorelasjonen mellom salg og kuponger som helhet. Fra dataen virker det som disse koorelerer noe mindre enn forventet, og tyder ikke på at perioder med økt salg er et produkt av flere promosjonskuponger brukt. 

```{r echo = FALSE, message=FALSE}
#fjerner warning meldinger fra html
options(warn = -1) 

#summerer opp etter uke, butikk og kupongbruk
df_total <- df %>%
  group_by(WEEK, STORE, SALE) %>%
  summarize(total_sales = sum(Sale_sum))

#summerer opp antall promosjoner etter uke og butikk
coupon_usage_by_week_store <- df_total %>%
  group_by(WEEK, STORE) %>%
  summarise(count = sum(SALE == "B", na.rm = TRUE))

#gjør om til månedlig
df_månedlig_kupong <- df_total %>%
  mutate(WEEK = as.numeric(WEEK)) %>%
  mutate(MONTH = ceiling(WEEK / 4))

#joiner datasett
df_månedlig_kupong <- left_join(df_månedlig_kupong, coupon_usage_by_week_store, by = c("WEEK", "STORE"))

#plotter og styler figur 8
figur8 <- df_månedlig_kupong %>%
  group_by(MONTH) %>%
  summarise(count_total = sum(count, na.rm = TRUE), total_sales_sum = sum(total_sales, na.rm = TRUE)) %>%
  ggplot(aes(x = MONTH)) +
  geom_bar(aes(y = total_sales_sum / 400, fill = "Totale salg, alle merker"), stat = "identity", width = 0.5, color = "black") +
  geom_line(aes(y = count_total, color = "Kuponger brukt"), size = 1.5) +
  labs(title = "Figur 8: Salg og kupongbruk",
       x = "Måned", y = "") +
  scale_fill_manual(values = c("#0072B2")) +
  scale_color_manual(values = c("#E69F00")) +
  theme_minimal() +
  theme(plot.title = element_text(size = 14, face = "bold"),
        axis.title = element_text(size = 12),
        axis.text = element_text(size = 10),
        legend.title = element_blank(),
        legend.text = element_text(size = 10),
        legend.position = "bottom")

figur8
```

*I figur 7 deler vi totale salg på 100, slik at vi kan se kupongbruken og lettere tolke koorelasjonen*  

```{r echo = FALSE, message=FALSE}
#fjerner warning meldinger fra html
options(warn = -1) 

#velger kun butikk 75
df_75 <- subset(df, STORE == "75")

#velger kun butikk 80
df_80 <- subset(df, STORE == "80")

#summerer opp data etter butikk og merke
df_75 <- df_75 %>%
  mutate(WEEK = as.numeric(WEEK)) %>%
  mutate(MONTH = ceiling(WEEK / 4)) %>%
  group_by(STORE, BRAND) %>%
  summarise(
    Sale_sum = sum(Sale_sum),
    Price_average = mean(Price_average),
    Profit_sum = sum(Profit_sum),
    Average_income = mean(income),
    custcoun = sum(custcoun),
    .groups = "drop") %>%
  mutate(Sale_sum_percent = Sale_sum / sum(Sale_sum) * 100)

#summerer opp data etter butikk og merke
df_80 <- df_80 %>%
 mutate(WEEK = as.numeric(WEEK)) %>%
  mutate(MONTH = ceiling(WEEK / 4)) %>%
  group_by(STORE, BRAND) %>%
  summarise(
    Sale_sum = sum(Sale_sum),
    Price_average = mean(Price_average),
    Profit_sum = sum(Profit_sum),
    Average_income = mean(income),
    custcoun = sum(custcoun),
    .groups = "drop") %>%
  mutate(Sale_sum_percent = Sale_sum / sum(Sale_sum) * 100)

#merger data
df_75_80 <- merge(df_75,df_80, all=T )
```

### Demografi - tabell

Tabell 1 sammenligner Store 75 -- Chicago, med Store 80 -- i Arlington Heights. Tabeller er fine å bruke i salgsrapporter, da de gir en enkel sammenligning, organisering, og det er lett for enhver å tolke dataen. 

Vi kan her se at butikken i Chicago har i underkant av 1/3 av salgene (av crackers) til Arlington. Prisen og profittmarginen på crackers i Chicago er også høyere enn i Arlington. Medianinntekten i området rundt butikken i Arlington er betydelig større enn dette i området rundt butikken i Chicago. Altså handler i dette tilfellet de fattigere på en dyrere butikk -- hvertfall når det kommer til crackers. Selv om antallet kunder på de to butikkene er ganske likt, kjøpes det mye mer crackers på butikken med høyere median inntekt. Det er nærliggende å anta at dette kommer av at crackers er langt fra en nødvendighet - og dermed er det større etterspørsel fra de rikere inntektsgruppene. Vi ser nærmere på dette i oppgave 4. 

```{r echo = FALSE, message=FALSE}
#fjerner warning meldinger fra html
options(warn = -1) 

#summerer opp data etter butikk
df_75_80 <- df_75_80 %>%
  mutate(Profittmargin = (Profit_sum/Sale_sum)*100) %>% 
  group_by(STORE) %>%
  summarise(
    Profitmargin = mean(Profittmargin),
    Average_income = mean(Average_income),
    custcoun = sum(custcoun),
    Sale_sum = sum(Sale_sum),
    Price_average = mean(Price_average),
    .groups = "drop"
  )

#finner inntekt i et ikke log format
df_75_80 <- df_75_80 %>%
  mutate(Average_income = exp(Average_income))


#endrer navn før de skal plasseres i en tabell
df_75_80 <- df_75_80 %>%
  rename("Butikk" = STORE,
         "Profittmargin" = Profitmargin,
         "Median inntekt" = Average_income,
         "Trafikk" = custcoun,
         "Salg" = Sale_sum,
         "Gjennomsnittlig pris" = Price_average )

#plotter tabell
kbl(df_75_80) %>%
  kable_styling()
```

## Oppgave 4 - nye utsalg

For å kunne benytte den tilgjengelige dataen til å gi et grunnlag for hvor det er gunstig å sette opp et nytt utsalg, må vi se om det er noen spesifikke verdier som koorelerer med salgstallene. Vi ser derfor nærmere på koorelasjonen mellom inntekten til kundene, og hvor mye crackers de handler. Vi ser også på sammenhengen mellom antall kunder som besøker butikkene og det totale salget. 

### **Sammenheng mellom inntekt og totale salg av crackers** 

Figur 9 er et scatterplottet som inkluderer alle butikkene i datasettet. Y aksen viser deres totale salg, og X aksen viser medianinntekten til kundene på den gitte butikken. Vi kjører en regresjonsanalyse for å se nærmere på disse tallene, og om de påvirker hverandre på noen måte. Ut fra denne viser at det ikke finnes noen reell sammenheng mellom medianinntekt og cracker salg i Chicago, til tross for funnene våre fra oppgave 3. 

```{r echo = FALSE, message=FALSE}
#fjerner warning meldinger fra html
options(warn = -1) 

#summerer data etter butikk
df_utsalg <- df %>%
  group_by(STORE) %>%
  summarise(
    Sale_sum = sum(Sale_sum),
    Average_income = mean(income),
    custcoun = sum(custcoun),
    .groups = "drop"
  )

#plotter og styler figur 9
figur9 <- df_utsalg %>%
  ggplot(aes(x = exp(Average_income), y = Sale_sum)) +
  geom_point(color = "steelblue", alpha = 0.7) +
  scale_size_continuous(range = c(2, 6)) +
  labs(title = "Figur 9: Regresjonsanalyse av medianinntekt og totale salg",
       x = "Medianinntekt", y = "Totale salg") +
  theme_minimal() +
  scale_x_continuous(labels = scales::comma_format()) +  # Endring av tallformatet på x-aksen
  geom_smooth(method = lm)

ggplotly(figur9)


```

### **Sammenheng mellom antall kunder og salg** 

Figur 10 sammenligner antall besøkende kunder på hver butikk med deres totale salg. Som antatt har disse en klar relasjon, hvor salget øker når antall kundebesøk øker. Grunnet dette vil vi heller fokusere på besøkstallet til de aktuelle områdene, ikke medianinntekt. Vi vil derfor heller plassere det nye utsalget i et området med høy trafikk.   

```{r echo = FALSE, message=FALSE}

#plotter og styler figur 10
figur10 <- df_utsalg %>%
  ggplot(aes(x = custcoun, y = Sale_sum)) +
  geom_point(color = "steelblue", alpha = 0.7) +
  scale_size_continuous(range = c(2, 6)) +
  labs(title = "Figur 10 - regresjonsanalyse av trafikk og totale salg",
       x = "Besøkstall", y = "Salg") +
  theme_minimal() +
  scale_x_continuous(labels = scales::comma_format()) +  # Endring av tallformatet på x-aksen
  geom_smooth(method = lm)

ggplotly(figur10)
```

```{r echo = FALSE, message=FALSE}
#fjerner warning meldinger fra html
options(warn = -1) 

#sumemrer opp hele datasettet etter butikk, og kordianter
df_kart <- df %>%
  group_by(STORE, lat, long) %>%
  summarise(custcoun = sum(custcoun),Sale_sum = sum(Sale_sum))

#omgjør data til ekte kordinater 
df_kart <- df_kart %>%
  mutate(lat = sub("(\\d{2})", "\\1.", lat)) %>%
  mutate(long = sub("(\\d{2})", "\\1.", long)) %>%
  mutate(lat = as.numeric(lat)) %>%
  mutate(long = as.numeric(long)) %>%
  mutate(long = -long)

#legger inn en google map api
register_google(key = "AIzaSyCSK01NcK-7-LKlLMOKbWfEjbhdCjzIkZ4")

#får chicago på kartet
chicago <- get_map(location = "chicago", zoom = 9, maptype = "terrain-background")
```

### **Aktuelle områder i Chicago**   

Figur 11 er et kart over Chicago, med data for kundebesøk og antall salg. Besøkstall vises som farge (rød = stor trafikk) og salg vises som størrelsen på punktene. Som nevnt ovenfor ser vi etter store besøkstall når vi plasserer det nye utsalget. Som en kan se i figur 11, har utsalgene med store besøkstall, ofte de beste salgstallene. Vi vil derfor anbefale å plassere det nye utsalget i et område med store besøkstall, og mye omsetning.  

```{r echo = FALSE, message=FALSE}
#fjerner warning meldinger fra html
options(warn = -1) 

#plotter figur 11
ggmap(chicago) +
  geom_point(data = df_kart, aes(x = long, y = lat, color = custcoun, size = Sale_sum), alpha = 0.5) +
  scale_color_continuous(labels = scales::comma_format(), low = "blue", high = "red", name = "Besøkstall") +
  scale_size_continuous(labels = scales::comma_format(), range = c(0.5, 5), name = "Salg") +
  theme_void() +
  ggtitle("Figur 11")

```
